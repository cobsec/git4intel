{"name": "Meterpreter or Cobalt Strike Getsystem Service Start", "description": "Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting", "created": "2019-10-26T00:00:00.000Z", "modified": "2019-11-11T00:00:00.000Z", "valid_from": "2019-10-26T00:00:00Z", "indicator_types": ["malicious-activity"], "pattern_type": "sigma", "pattern": "title: Meterpreter or Cobalt Strike Getsystem Service Start\nid: 15619216-e993-4721-b590-4c520615a67d\ndescription: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting\nauthor: Teymur Kheirkhabarov\ndate: 2019/10/26\nmodified: 2019/11/11\nreferences:\n    - https://speakerdeck.com/heirhabarov/hunting-for-privilege-escalation-in-windows-environment\n    - https://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/\ntags:\n    - attack.privilege_escalation\n    - attack.t1134\nlogsource:\n    category: process_creation\n    product: windows\ndetection:\n    selection_1:\n        ParentImage|endswith: '\\services.exe'\n    selection_2:    \n        - CommandLine|contains:\n            - 'cmd'\n            - 'comspec'\n        # meterpreter getsystem technique 1: cmd.exe /c echo 559891bb017 > \\\\.\\pipe\\5e120a\n        - CommandLine|contains|all:\n            - 'cmd'\n            - '/c'\n            - 'echo'\n            - '\\pipe\\'\n        # cobaltstrike getsystem technique 1: %COMSPEC% /c echo 559891bb017 > \\\\.\\pipe\\5e120a\n        - CommandLine|contains|all:\n            - '%COMSPEC%'\n            - '/c'\n            - 'echo'\n            - '\\pipe\\'\n        # meterpreter getsystem technique 2: rundll32.exe C:\\Users\\test\\AppData\\Local\\Temp\\tmexsn.dll,a /p:tmexsn\n        - CommandLine|contains|all:\n            - 'rundll32'\n            - '.dll,a'\n            - '/p:'\n    filter1:\n        CommandLine|contains: 'MpCmdRun'\n    condition: selection_1 and selection_2 and not filter1\nfields:\n    - ComputerName\n    - User\n    - CommandLine\nfalsepositives:\n    - Commandlines containing components like cmd accidentally\n    - Jobs and services started with cmd\nlevel: high\n", "object_marking_refs": ["marking-definition--0a872d70-1d05-45dd-a25f-031af547a102"], "created_by_ref": "identity--082ca4f0-d825-45b6-aa42-ab9afd1e5503", "type": "indicator", "spec_version": "2.1", "id": "indicator--9df6df16-89ae-440b-ac53-e7fd5b37e8e5"}