{"name": "Dumping Lsass.exe Memory with MiniDumpWriteDump API", "description": "Detects the use of MiniDumpWriteDump API for dumping lsass.exe memory in a stealth way. Tools like ProcessHacker and some attacker tradecract use this API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and transfer it over the network back to the attacker's machine.", "created": "2019-10-27T00:00:00.000Z", "modified": "2019-11-13T00:00:00.000Z", "valid_from": "2019-10-27T00:00:00Z", "indicator_types": ["malicious-activity"], "pattern_type": "sigma", "pattern": "title: Dumping Lsass.exe Memory with MiniDumpWriteDump API\nid: dd5ab153-beaa-4315-9647-65abc5f71541\nstatus: experimental\ndescription: Detects the use of MiniDumpWriteDump API for dumping lsass.exe memory in a stealth way. Tools like ProcessHacker and some attacker tradecract use this\n    API found in dbghelp.dll or dbgcore.dll. As an example, SilentTrynity C2 Framework has a module that leverages this API to dump the contents of Lsass.exe and\n    transfer it over the network back to the attacker's machine.\ndate: 2019/10/27\nmodified: 2019/11/13\nauthor: Perez Diego (@darkquassar), oscd.community\nreferences:\n    - https://docs.microsoft.com/en-us/windows/win32/api/minidumpapiset/nf-minidumpapiset-minidumpwritedump\n    - https://www.pinvoke.net/default.aspx/dbghelp/MiniDumpWriteDump.html\n    - https://medium.com/@fsx30/bypass-edrs-memory-protection-introduction-to-hooking-2efb21acffd6\ntags:\n    - attack.credential_access\n    - attack.t1003\nlogsource:\n    product: windows\n    service: sysmon\ndetection:\n    signedprocess:\n        EventID: 7\n        ImageLoaded|endswith:\n            - '\\dbghelp.dll'\n            - '\\dbgcore.dll'\n        Image|endswith: \n            - '\\msbuild.exe'\n            - '\\cmd.exe'\n            - '\\svchost.exe'\n            - '\\rundll32.exe'\n            - '\\powershell.exe'\n            - '\\word.exe'\n            - '\\excel.exe'\n            - '\\powerpnt.exe'\n            - '\\outlook.exe'\n            - '\\monitoringhost.exe'\n            - '\\wmic.exe'\n            - '\\msiexec.exe'\n            - '\\bash.exe'\n            - '\\wscript.exe'\n            - '\\cscript.exe'\n            - '\\mshta.exe'\n            - '\\regsvr32.exe'\n            - '\\schtasks.exe'\n            - '\\dnx.exe'\n            - '\\regsvcs.exe'\n            - '\\sc.exe'\n            - '\\scriptrunner.exe'\n    unsignedprocess:\n        EventID: 7\n        ImageLoaded|endswith:\n            - '\\dbghelp.dll'\n            - '\\dbgcore.dll'\n        Signed: \"FALSE\"\n    filter:\n        Image|contains: 'Visual Studio'\n    condition: (signedprocess AND NOT filter) OR (unsignedprocess AND NOT filter)\nfields:\n    - ComputerName\n    - User\n    - Image\n    - ImageLoaded\nfalsepositives:\n    - Penetration tests\nlevel: critical\n", "object_marking_refs": ["marking-definition--0a872d70-1d05-45dd-a25f-031af547a102"], "created_by_ref": "identity--082ca4f0-d825-45b6-aa42-ab9afd1e5503", "type": "indicator", "spec_version": "2.1", "id": "indicator--5992c3df-aecd-406a-b5a5-d7a83f3e434f"}