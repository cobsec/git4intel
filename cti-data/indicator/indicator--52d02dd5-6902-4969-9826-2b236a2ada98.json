{"name": "Invoke-Obfuscation Obfuscated IEX Invocation", "description": "Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \u2014 https://github.com/danielbohannon/Invoke-Obfuscation/blob/master/Out-ObfuscatedStringCommand.ps1#L873-L888", "created": "2019-11-08T00:00:00.000Z", "valid_from": "2019-11-08T00:00:00Z", "indicator_types": ["malicious-activity"], "pattern_type": "sigma", "pattern": "title: Invoke-Obfuscation Obfuscated IEX Invocation\nid: 1b9dc62e-6e9e-42a3-8990-94d7a10007f7\ndescription: \"Detects all variations of obfuscated powershell IEX invocation code generated by Invoke-Obfuscation framework from the following code block \\u2014 https://github.com/danielbohannon/Invoke-Obfuscation/blob/master/Out-ObfuscatedStringCommand.ps1#L873-L888\"\nstatus: experimental\nauthor: Daniel Bohannon (@Mandiant/@FireEye), oscd.community\ndate: 2019/11/08\ntags:\n    - attack.defense_evasion\n    - attack.t1027\nlogsource:\n    product: windows\n    service: powershell\ndetection:\n    selection_1:\n        EventID: 4104\n    selection_2:\n        - ScriptBlockText|re: '\\$PSHome\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$PSHome\\['\n        - ScriptBlockText|re: '\\$ShellId\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$ShellId\\['\n        - ScriptBlockText|re: '\\$env:Public\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$env:Public\\['\n        - ScriptBlockText|re: '\\$env:ComSpec\\[(\\s*\\d{1,3}\\s*,){2}'\n        - ScriptBlockText|re: '\\*mdr\\*\\W\\s*\\)\\.Name'\n        - ScriptBlockText|re: '\\$VerbosePreference\\.ToString\\('\n        - ScriptBlockText|re: '\\String\\]\\s*\\$VerbosePreference'\n    selection_3:\n        EventID: 4103\n    selection_4:\n        - Payload|re: '\\$PSHome\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$PSHome\\['\n        - Payload|re: '\\$ShellId\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$ShellId\\['\n        - Payload|re: '\\$env:Public\\[\\s*\\d{1,3}\\s*\\]\\s*\\+\\s*\\$env:Public\\['\n        - Payload|re: '\\$env:ComSpec\\[(\\s*\\d{1,3}\\s*,){2}'\n        - Payload|re: '\\*mdr\\*\\W\\s*\\)\\.Name'\n        - Payload|re: '\\$VerbosePreference\\.ToString\\('\n        - Payload|re: '\\String\\]\\s*\\$VerbosePreference'\n    condition: ( selection_1 and selection_2 ) or ( selection_3 and selection_4 )\nfalsepositives:\n    - Unknown\nlevel: high\n", "object_marking_refs": ["marking-definition--0a872d70-1d05-45dd-a25f-031af547a102"], "created_by_ref": "identity--082ca4f0-d825-45b6-aa42-ab9afd1e5503", "type": "indicator", "spec_version": "2.1", "id": "indicator--52d02dd5-6902-4969-9826-2b236a2ada98", "modified": "2020-04-02T10:14:32.653Z"}