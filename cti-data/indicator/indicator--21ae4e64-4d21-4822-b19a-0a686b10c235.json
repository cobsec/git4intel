{"name": "AD User Enumeration", "description": "Detects access to a domain user from a non-machine account", "created": "2020-03-30T00:00:00.000Z", "valid_from": "2020-03-30T00:00:00Z", "indicator_types": ["malicious-activity"], "pattern_type": "sigma", "pattern": "title: AD User Enumeration\nid: ab6bffca-beff-4baa-af11-6733f296d57a\ndescription: Detects access to a domain user from a non-machine account\nstatus: experimental\ndate: 2020/03/30\nauthor: Maxime Thiebaut (@0xThiebaut)\nreferences:\n    - https://www.specterops.io/assets/resources/an_ace_up_the_sleeve.pdf\n    - http://www.stuffithoughtiknew.com/2019/02/detecting-bloodhound.html\n    - https://docs.microsoft.com/en-us/windows/win32/adschema/attributes-all # For further investigation of the accessed properties\ntags:\n    - attack.discovery\n    - attack.t1087\nlogsource:\n    product: windows\n    service: security\n    definition: Requires the \"Read all properties\" permission on the user object to be audited for the \"Everyone\" principal\ndetection:\n    selection:\n        EventID: 4662\n        ObjectType|contains: # Using contains as the data commonly is structured as \"%{bf967aba-0de6-11d0-a285-00aa003049e2}\"\n            - 'bf967aba-0de6-11d0-a285-00aa003049e2' # The user class (https://docs.microsoft.com/en-us/windows/win32/adschema/c-user)\n    filter:\n        - SubjectUserName|endswith: '$' # Exclude machine accounts\n        - SubjectUserName|startswith: 'MSOL_' # https://docs.microsoft.com/en-us/azure/active-directory/hybrid/reference-connect-accounts-permissions#ad-ds-connector-account\n    condition: selection and not filter\nfalsepositives:\n    - Administrators configuring new users.\nlevel: medium\n", "object_marking_refs": ["marking-definition--0a872d70-1d05-45dd-a25f-031af547a102"], "created_by_ref": "identity--082ca4f0-d825-45b6-aa42-ab9afd1e5503", "type": "indicator", "spec_version": "2.1", "id": "indicator--21ae4e64-4d21-4822-b19a-0a686b10c235", "modified": "2020-04-02T10:15:14.636Z"}